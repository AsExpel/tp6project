<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>admin_index</title>
        <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
        <script src="__JS__/echarts.min.js" type="text/javascript"></script><!--引入echarts-->
    </head>
<body>
    <div id="main" style="width: 1000px;height:600px;"></div>

    <script type="text/javascript">
        let url = document.URL + "/index/";


        $(document).ready(
            function (){
          var _url = url + "get_all_bug";
          $.ajax({
            //请求方式
            type: "POST",
            //请求地址
            url: _url,
            //in
            data: '',
            //out
            complete() {},
            success(result) {
              // console.log(result);
              let   item = $.parseJSON(result),
                    dataList=[],//用于记录各tag的数目
                    tagList=[];//用于存储各tag

                for(let i=0;i<item.length;i++){
                    //循环整个item
                    let hasTag=false;//“是否是新tag”标记
                    for(let ii=0;ii<tagList.length;ii++){
                        //循环整个tagList
                        if(item[i].bug_tag===tagList[ii].toString()){   //如果数据中的bug_tag与已有tag相等
                            dataList[ii]++;
                            hasTag=true;                                //变更标记，不需要新增tag
                            break;                                      //已找到对应tag，跳出ii循环
                        }
                    }
                    if(!hasTag){                                        //如果没有已有标签对应
                        var newArray=[''];                              //定义一个数组
                        newArray[0]=item[i].bug_tag.toString();         //赋值为新bug_tag
                        tagList.push(newArray);                         //加入已有tag中
                        dataList[tagList.length-1]=1;                   //dataList数组+1长度，赋初始值为1
                    }
                }
                let chartData=[{}];                                     //新建json对象数组(“[]”是数组，“{}”是对象)
                for(let ii=0;ii<tagList.length;ii++){
                    let newObject={'name':tagList[ii],'value':dataList[ii]};//新建对象
                    chartData.push(newObject);                          //将新对象加入chartData
                }


                console.log(chartData);
                // 基于准备好的dom，初始化echarts实例
                var myChart = echarts.init(document.getElementById('main'));
                var option={
                    backgroundColor: '#2c343c',//定义背景色
                    textStyle: {
                        color: 'rgba(255, 255, 255, 0.3)'//定义文字颜色
                    },
                    series : [
                        {
                            name: '访问来源',
                            type: 'pie',
                            radius: '10%',                                  //饼状图半径
                            data:chartData,                                //将chartData输出
                            roseType: 'angle',

                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 200,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            },
                            label: {
                                normal: {
                                    textStyle: {
                                        color: 'rgba(255, 255, 255, 0.3)'
                                    }
                                }
                            },
                            labelLine: {
                                normal: {
                                    lineStyle: {
                                        color: 'rgba(255, 255, 255, 0.3)'
                                    }
                                }
                            }

                        }
                    ]//定义序列，交由Echarts渲染
                };
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            },
            //请求失败，包含具体的错误信息
            error(e) {
              console.log(e.status);
              console.log(e.responseText);
            }
          });
        },
        );
    </script>
</body>
</html>
