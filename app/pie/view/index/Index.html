<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>admin_index</title>
        <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
    </head>
<body>
    <canvas id="myChart" width="200" height="200"></canvas>

    <script type="text/javascript">
        let url = document.URL + "/index/";
        //原型
        var Canvas = function(ele,num){
            this.ele = ele;
            this.num = num;
            this.ctx = this.ele.getContext("2d");
            this.color = ["#21a74f","#b3e5f1","#3498db","#2ecc71","#f1c40f","#e67e22"];
            this.draw();
        };
        Canvas.prototype.draw=function(){
            var j=0,j1=0,j2=0,angle=0;
            var sum=0;
            for(var i=0;i<this.num.length;i++){
                sum=sum+this.num[i];
            }

            for(var i=0;i<this.num.length;i++){
                j=2*Math.PI*this.num[i]/sum;
                j2=j1+j;
                this.ctx.beginPath();
                this.ctx.fillStyle=this.color[i];
                this.ctx.arc(this.ele.width/2,this.ele.height/2,120,j1,j2,false);
                this.ctx.lineTo(this.ele.width/2,this.ele.height/2);
                this.ctx.closePath();
                this.ctx.fill();
                angle=j1+j/2;
                j1=j1+j;
            }
        };
        $(document).ready(
            function (){
          var _url = url + "get_all_bug";
          $.ajax({
            //请求方式
            type: "POST",
            //请求地址
            url: _url,
            //in
            data: '',
            //out
            complete() {},
            success(result) {
              $("#append").empty();
              // console.log(result);
              let   item = $.parseJSON(result),
                    datalist=[],
                    taglist=[];
              item.forEach((element, i) => {
                  if(!datalist[element.bug_tag]) {
                      var arr = [];
                      arr.push(element);
                      taglist.push(element.bug_tag);
                      datalist[element.bug_tag] = arr;
                  }else {
                      datalist[element.bug_tag].push(element);
                  }
              });
              var ctx = document.getElementById("myChart").getContext('2d');
              var num1=[];
              taglist.forEach((element,i)=>{
                  num1.push(datalist[element].length);
              });
              var myChart = new Chart(ctx, {
                  type: 'pie',
                  data: {
                      labels: taglist,
                      datasets: [{
                          label: '# of Votes',
                          data: num1,
                          backgroundColor: [
                              'rgba(255, 99, 132, 0.2)',
                              'rgba(54, 162, 235, 0.2)',
                              'rgba(255, 206, 86, 0.2)',
                              'rgba(75, 192, 192, 0.2)',
                              'rgba(153, 102, 255, 0.2)',
                              'rgba(255, 159, 64, 0.2)'
                          ],
                      }]
                  },
                  options: {
                      responsive: true
                  }
              });


                // $("#append").append(function (n) {
                //     return(
                //         "<div>" +
                //         "id:" +
                //         element.bug_id +
                //         " name:" +
                //         element.bug_name +
                //         " tag:"+
                //         element.bug_tag +
                //         "</div>"
                //     );
                // })
              // console.log(item);
            },
            //请求失败，包含具体的错误信息
            error(e) {
              console.log(e.status);
              console.log(e.responseText);
            }
          });




        },

        );
    </script>
</body>
</html>
